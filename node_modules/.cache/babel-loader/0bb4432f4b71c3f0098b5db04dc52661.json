{"ast":null,"code":"var _s = $RefreshSig$();\n//facial-rec.js\nimport { useEffect, useState, useRef } from 'react';\nimport * as faceLandmarksDetection from '@tensorflow-models/face-landmarks-detection';\nimport '@tensorflow/tfjs-backend-webgl';\nexport const useFaceDetector = videoRef => {\n  _s();\n  const [detector, setDetector] = useState(null);\n  const detectionInterval = useRef(null);\n  const audioRef = useRef(new Audio('/ringtone-126505.mp3'));\n  const [playSound, setPlaySound] = useState(false);\n  useEffect(() => {\n    console.log('Loading model...');\n    const loadModel = async () => {\n      const model = faceLandmarksDetection.SupportedModels.MediaPipeFaceMesh;\n      const detectorConfig = {\n        runtime: 'tfjs',\n        solutionPath: 'https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh'\n      };\n      const detector = await faceLandmarksDetection.createDetector(model, detectorConfig);\n      setDetector(detector);\n      console.log('Model loaded.');\n    };\n    loadModel();\n  }, []);\n  useEffect(() => {\n    console.log('Setting up interval...');\n    const checkFaces = async () => {\n      console.log('Checking faces...');\n      if (videoRef.current && !videoRef.current.paused && !videoRef.current.ended && detector) {\n        console.log('Video is playing, detecting faces...');\n        const faces = await detector.estimateFaces(videoRef.current, {\n          flipHorizontal: false\n        });\n        if (faces.length > 0) {\n          console.log(faces);\n          try {\n            var _faces$, _faceNames$find, _faceNames$find2, _faceNames$find3, _faceNames$find4;\n            const faceNames = (_faces$ = faces[0]) === null || _faces$ === void 0 ? void 0 : _faces$.keypoints.filter(item => item.hasOwnProperty('name'));\n            const rightEye = faceNames === null || faceNames === void 0 ? void 0 : (_faceNames$find = faceNames.find(item => item.name === \"rightEye\")) === null || _faceNames$find === void 0 ? void 0 : _faceNames$find.x;\n            const leftEye = faceNames === null || faceNames === void 0 ? void 0 : (_faceNames$find2 = faceNames.find(item => item.name === \"leftEye\")) === null || _faceNames$find2 === void 0 ? void 0 : _faceNames$find2.x;\n            const faceOvalRight = faceNames === null || faceNames === void 0 ? void 0 : (_faceNames$find3 = faceNames.find(item => item.name === \"faceOval\" && item.index === 26)) === null || _faceNames$find3 === void 0 ? void 0 : _faceNames$find3.x;\n            const faceOvalLeft = faceNames === null || faceNames === void 0 ? void 0 : (_faceNames$find4 = faceNames.find(item => item.name === \"faceOval\" && item.index === 15)) === null || _faceNames$find4 === void 0 ? void 0 : _faceNames$find4.x;\n            console.log(`Right Eye: ${rightEye}, Left Eye: ${leftEye}, Face Oval Right: ${faceOvalRight}, Face Oval Left: ${faceOvalLeft}`);\n            if (rightEye && leftEye && faceOvalRight && faceOvalLeft) {\n              console.log(\"All keypoints found.\");\n              console.log(`Condition check: Right Eye + 50 > Face Oval Right (${rightEye + 50} > ${faceOvalRight})`);\n              console.log(`Condition check: Left Eye - 50 < Face Oval Left (${leftEye - 50} < ${faceOvalLeft})`);\n              if (rightEye + 50 > faceOvalRight || leftEye - 50 < faceOvalLeft) {\n                console.log(\"Entering condition for sound play.\");\n                if (!playSound) {\n                  setPlaySound(true);\n                  audioRef.current.play();\n                  console.log(\"Condition met, playing sound.\");\n                }\n              } else {\n                console.log(\"Entering condition for sound pause.\");\n                if (playSound) {\n                  setPlaySound(false);\n                  audioRef.current.pause();\n                  audioRef.current.currentTime = 0;\n                  console.log(\"Condition not met, stopping sound.\");\n                }\n              }\n            } else {\n              console.log(\"One or more keypoints are undefined.\");\n            }\n          } catch (error) {\n            console.error(\"Error processing facial landmarks:\", error);\n          }\n        } else {\n          console.log(\"No faces detected.\");\n        }\n      }\n    };\n    if (detector && videoRef.current) {\n      checkFaces(); // Run immediately on load\n      detectionInterval.current = setInterval(checkFaces, 3000); // Changed to 30 seconds as per requirement\n    }\n    return () => {\n      if (detectionInterval.current) {\n        clearInterval(detectionInterval.current);\n      }\n      if (audioRef.current) {\n        audioRef.current.pause();\n      }\n      console.log('Cleanup done.');\n    };\n  }, [detector, videoRef, playSound]); // Removed playSound from dependencies to prevent re-triggering on its change\n\n  return null;\n};\n_s(useFaceDetector, \"TvLLSFIwkrzV/noFkLAUu1ZEITM=\");","map":{"version":3,"names":["useEffect","useState","useRef","faceLandmarksDetection","useFaceDetector","videoRef","_s","detector","setDetector","detectionInterval","audioRef","Audio","playSound","setPlaySound","console","log","loadModel","model","SupportedModels","MediaPipeFaceMesh","detectorConfig","runtime","solutionPath","createDetector","checkFaces","current","paused","ended","faces","estimateFaces","flipHorizontal","length","_faces$","_faceNames$find","_faceNames$find2","_faceNames$find3","_faceNames$find4","faceNames","keypoints","filter","item","hasOwnProperty","rightEye","find","name","x","leftEye","faceOvalRight","index","faceOvalLeft","play","pause","currentTime","error","setInterval","clearInterval"],"sources":["/Users/sanskarmishra/Hackathon-2024/sera/src/facial-rec.js"],"sourcesContent":["//facial-rec.js\nimport { useEffect, useState, useRef } from 'react';\nimport * as faceLandmarksDetection from '@tensorflow-models/face-landmarks-detection';\nimport '@tensorflow/tfjs-backend-webgl';\n\nexport const useFaceDetector = (videoRef) => {\n    const [detector, setDetector] = useState(null);\n    const detectionInterval = useRef(null);\n    const audioRef = useRef(new Audio('/ringtone-126505.mp3'));\n    const [playSound, setPlaySound] = useState(false);\n\n    useEffect(() => {\n        console.log('Loading model...');\n        const loadModel = async () => {\n            const model = faceLandmarksDetection.SupportedModels.MediaPipeFaceMesh;\n            const detectorConfig = {\n                runtime: 'tfjs',\n                solutionPath: 'https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh',\n            };\n            const detector = await faceLandmarksDetection.createDetector(model, detectorConfig);\n            setDetector(detector);\n            console.log('Model loaded.');\n        };\n\n        loadModel();\n    }, []);\n\n    useEffect(() => {\n        console.log('Setting up interval...');\n        const checkFaces = async () => {\n            console.log('Checking faces...');\n            if (videoRef.current && !videoRef.current.paused && !videoRef.current.ended && detector) {\n                console.log('Video is playing, detecting faces...');\n                const faces = await detector.estimateFaces(videoRef.current, { flipHorizontal: false });\n                if (faces.length > 0) {\n                    console.log(faces);\n                    try {\n                        const faceNames = faces[0]?.keypoints.filter(item => item.hasOwnProperty('name'));\n                        const rightEye = faceNames?.find(item => item.name === \"rightEye\")?.x;\n                        const leftEye = faceNames?.find(item => item.name === \"leftEye\")?.x;\n                        const faceOvalRight = faceNames?.find(item => item.name === \"faceOval\" && item.index === 26)?.x;\n                        const faceOvalLeft = faceNames?.find(item => item.name === \"faceOval\" && item.index === 15)?.x;\n        \n                        console.log(`Right Eye: ${rightEye}, Left Eye: ${leftEye}, Face Oval Right: ${faceOvalRight}, Face Oval Left: ${faceOvalLeft}`);\n        \n                        if (rightEye && leftEye && faceOvalRight && faceOvalLeft) {\n                            console.log(\"All keypoints found.\");\n                            console.log(`Condition check: Right Eye + 50 > Face Oval Right (${rightEye + 50} > ${faceOvalRight})`);\n                            console.log(`Condition check: Left Eye - 50 < Face Oval Left (${leftEye - 50} < ${faceOvalLeft})`);\n                            if (rightEye + 50 > faceOvalRight || leftEye - 50 < faceOvalLeft) {\n                                console.log(\"Entering condition for sound play.\");\n                                if (!playSound) {\n                                    setPlaySound(true);\n                                    audioRef.current.play();\n                                    console.log(\"Condition met, playing sound.\");\n                                }\n                            } else {\n                                console.log(\"Entering condition for sound pause.\");\n                                if (playSound) {\n                                    setPlaySound(false);\n                                    audioRef.current.pause();\n                                    audioRef.current.currentTime = 0;\n                                    console.log(\"Condition not met, stopping sound.\");\n                                }\n                            }\n                        } else {\n                            console.log(\"One or more keypoints are undefined.\");\n                        }\n                    } catch (error) {\n                        console.error(\"Error processing facial landmarks:\", error);\n                    }\n                } else {\n                    console.log(\"No faces detected.\");\n                }\n            }\n        };\n\n        if (detector && videoRef.current) {\n            checkFaces(); // Run immediately on load\n            detectionInterval.current = setInterval(checkFaces, 3000); // Changed to 30 seconds as per requirement\n        }\n\n        return () => {\n            if (detectionInterval.current) {\n                clearInterval(detectionInterval.current);\n            }\n            if (audioRef.current) {\n                audioRef.current.pause();\n            }\n            console.log('Cleanup done.');\n        };\n    }, [detector, videoRef, playSound]); // Removed playSound from dependencies to prevent re-triggering on its change\n\n    return null;\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}